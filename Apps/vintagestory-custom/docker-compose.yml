name: "vintagestory-custom"
services:
  vintagestory:
    image: ghcr.io/joshevans-weber/vintagestory-custom:latest
    container_name: vs-server
    restart: unless-stopped
    # Bridge network is the default - explicitly setting it here for clarity
    # Ports will be mapped from container to host via Docker's port forwarding
    ports:
      - "0.0.0.0:42420:42420/udp"
      - "0.0.0.0:7681:7681/tcp"
      - "0.0.0.0:5000:5000/tcp"
    volumes:
      - type: bind
        source: /DATA/AppData/vintagestory/data
        target: /vintagestory/data
    environment:
      - SERVICE=VintagestoryServer.dll
      - UID_NUMBER=1100
      - GID_NUMBER=1100
      - TERMINAL_USER=evans
      - TERMINAL_PASS=camp3rjake
    stdin_open: true
    tty: true
    user: "0:0"  # Start as root to fix permissions, then drop to UID_NUMBER
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f VintagestoryServer > /dev/null && echo 'OK' || (pgrep -f dotnet > /dev/null && echo 'Starting' || exit 1)"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
x-casaos:
  architectures: ["amd64"]
  main: vintagestory
  title:
    en_us: "VintageStory"
  icon: "https://www.vintagestory.at/img/vintagestory-logo.png"
  author: "JoshEvans-Weber"
  category: "Games"
  version: "20260125-0518"
  tagline:
    en_us: "Vintage Story dedicated server with web console"
  description:
    en_us: |
      Vintage Story dedicated server with tmux and ttyd for web-based console access.
      
      ğŸ® Game Port: 42420/udp
      ğŸŒ Web Console: http://your-ip:7681 (user: evans, pass: camp3rjake)
      
      The server will automatically create and configure the data directory on first run.
  developer: "Anego Studios"
  website: "https://www.vintagestory.at/"
  port_map: "42420"
