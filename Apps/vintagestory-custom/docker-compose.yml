version: '3.8'

services:
  vintagestory:
    image: ghcr.io/joshevans-weber/vs-custom:latest
    container_name: vs-server
    restart: always
    ports:
      - "${SERVER_PORT:-42420}:42420/udp"
      - "7681:7681"
    volumes:
      - /DATA/AppData/vintagestory/data:/vintagestory/data
    environment:
      # --- System & Permissions ---
      - UID_NUMBER=${UID_NUMBER:-1100}
      - GID_NUMBER=${GID_NUMBER:-1100}
      - DOTNET_GCHeapHardLimit=${DOTNET_GC_LIMIT:-0x280000000}
      - DOTNET_gcServer=${DOTNET_GC_SERVER:-1}
      
      # --- Server Identity ---
      - SERVER_NAME=${SERVER_NAME:-Vintage Story Server}
      - WELCOME_MESSAGE=${WELCOME_MESSAGE:-Welcome {0}, may you survive well and prosper}
      - SERVER_DESCRIPTION=${SERVER_DESCRIPTION}
      - MAX_CLIENTS=${MAX_CLIENTS:-16}
      - SERVER_PASSWORD=${SERVER_PASSWORD}
      - ADVERTISE_SERVER=${ADVERTISE_SERVER:-false}
      - ONLY_WHITELISTED=${ONLY_WHITELISTED:-false}
      
      # --- Gameplay Logic ---
      - WORLD_NAME=${WORLD_NAME:-Vintage Story World}
      - WORLD_SEED=${WORLD_SEED}
      - PLAY_STYLE=${PLAY_STYLE:-surviveandbuild}
      - PASS_TIME_WHEN_EMPTY=${PASS_TIME_WHEN_EMPTY:-false}
      - ALLOW_CREATIVE_MODE=${ALLOW_CREATIVE_MODE:-true}
      - ALLOW_PVP=${ALLOW_PVP:-true}
      
      # --- World Config (The "June" Settings) ---
      - WORLDCONFIG_GAME_MODE=${GAME_MODE:-survival}
      - WORLDCONFIG_MOVE_SPEED=${MOVE_SPEED:-1.5}
      - WORLDCONFIG_PLAYER_HEALTH=${PLAYER_HEALTH:-15}
      - WORLDCONFIG_HUNGER_SPEED=${HUNGER_SPEED:-1}
      - WORLDCONFIG_FOOD_SPOIL=${FOOD_SPOIL:-1}
      - WORLDCONFIG_TOOL_DURABILITY=${TOOL_DURABILITY:-1}
      - WORLDCONFIG_SAPLING_GROWTH=${SAPLING_GROWTH:-1}
      - WORLDCONFIG_CREATURE_HOSTILITY=${HOSTILITY:-aggressive}
      - WORLDCONFIG_DEATH_PUNISHMENT=${DEATH_PUNISHMENT:-drop}
      - WORLDCONFIG_TEMPORAL_STORMS=${STORMS:-sometimes}
      - WORLDCONFIG_TEMPORAL_RIFTS=${RIFTS:-visible}
      - WORLDCONFIG_ALLOW_MAP=${ALLOW_MAP:-true}
      - WORLDCONFIG_ALLOW_COORDINATES=${ALLOW_COORDS:-true}
      - WORLDCONFIG_WORLD_CLIMATE=${CLIMATE:-realistic}
      
      # --- Advanced/Fixed Paths ---
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - SAVE_FILE_LOCATION=/vintagestory/data/Saves/default.vcdbs
      - DATAPATH=/vintagestory/data
      - VSPATH=/vintagestory/server
    stdin_open: true
    tty: true

x-casaos:
  architectures:
    - amd64
  main: vintagestory
  icon: https://wiki.vintagestory.at/images/8/8a/Gamelogo-vintagestory.png
  title:
    en_us: Vintage Story
  description:
    en_us: "The complete server build with all environment variables exposed for easy tweaking."
  port_map: "7681"
  envs:
    - container: SERVER_NAME
      description: { en_us: "Server name in browser" }
    - container: MOVE_SPEED
      description: { en_us: "Movement speed multiplier (1.5)" }
    - container: HOSTILITY
      description: { en_us: "Creature behavior (aggressive/passive)" }
    - container: OPENAI_API_KEY
      description: { en_us: "API Key for AI mods" }
    - container: DEATH_PUNISHMENT
      description: { en_us: "What happens on death (drop/keep)" }
    - container: UID_NUMBER
      description: { en_us: "System User ID (1100)" }
